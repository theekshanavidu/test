<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Tracker</title>
<link rel="icon" type="image/png" href="https://img.freepik.com/premium-vector/reading-owl-logo-simple-vector-design_609149-1053.jpg?semt=ais_hybrid&w=740&q=80">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
  body { background: black; color: white; min-height: 100vh; font-family: sans-serif; }
  .input-field { padding: 0.5rem; border-radius: 0.5rem; background: #1e293b; border: none; color: white; width: 100%; margin-bottom: 0.5rem; }
  .liquid-btn { position: relative; padding: 0.5rem 1.5rem; color: white; overflow: hidden; border: none; border-radius: 1rem; background: #0ea5e9; cursor: pointer; font-weight: bold; margin: 0.2rem; transition: 0.3s; }
  .liquid-btn::before { content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: rgba(255,255,255,0.2); transform: skewX(-20deg); transition: 0.5s; }
  .liquid-btn:hover::before { left: 100%; }
  .liquid-btn:hover { box-shadow: 0 0 20px #0ea5e9; }
  .google-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 0.5rem 1.5rem; border: 2px solid #0ea5e9; border-radius: 0.5rem; background: transparent; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
  .google-btn:hover { background: rgba(14, 165, 233, 0.1); box-shadow: 0 0 10px #0ea5e9; }
  .google-logo { width: 20px; height: 20px; }
  .admin-badge { background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile, updateEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, addDoc, collection, getDocs, getDoc, query, where, updateDoc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDYhulc8Qz_xGfIeb1g9A6BGO2wwbrz82M",
    authDomain: "study-9c374.firebaseapp.com",
    projectId: "study-9c374",
    storageBucket: "study-9c374.appspot.com",
    messagingSenderId: "82946998504",
    appId: "1:82946998504:web:290cd36a2559846891095d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();
const ADMIN_UID = "m1rddMA36WbVunFW3B0BzuqOwyI2";

let currentUser = null;
const appContainer = document.getElementById('app-container');
const headerButtons = document.getElementById('header-buttons');

// ---------- ROUTER ----------
function navigateTo(path) {
    window.history.pushState({}, "", path);
    router();
}
window.onpopstate = () => router();

async function router() {
    const path = window.location.pathname;
    const parts = path.split('/').filter(p => p !== "");

    if (!currentUser && !['/login', '/register'].includes(path)) { renderWelcome(); return; }

    if (path === "/login") renderLogin();
    else if (path === "/register") renderRegister();
    else if (path === "/home" || path === "/") renderHome();
    else if (path === "/profile") renderProfile();
    else if (path === "/timetable") renderTimetable();
    else if (path === "/adminpanel") renderAdmin();
    else if (path === "/recording") renderSubjects();
    else if (parts[0] === "recording" && parts.length === 2) renderType(parts[1]);
    else if (parts[0] === "recording" && parts.length === 3) renderLessons(parts[1], parts[2]);
    else if (parts[0] === "recording" && parts.length === 4) {
        const day = parts[3].replace("lesson", "");
        openLessonPage(parts[1], parts[2], day);
    }
    else { renderHome(); }
}

onAuthStateChanged(auth, u => {
    currentUser = u;
    renderHeader();
    router();
});

function renderHeader() {
    headerButtons.innerHTML = '';
    if (currentUser) {
        headerButtons.appendChild(createBtn("Home", () => navigateTo('/home')));
        headerButtons.appendChild(createBtn("Timetable", () => navigateTo('/timetable')));
        headerButtons.appendChild(createBtn("Profile", () => navigateTo('/profile')));
        if(currentUser.uid === ADMIN_UID) headerButtons.appendChild(createBtn("Admin", () => navigateTo('/adminpanel')));
        headerButtons.appendChild(createBtn("Logout", async () => { await signOut(auth); navigateTo('/login'); }));
    } else {
        headerButtons.appendChild(createBtn("Login", () => navigateTo('/login')));
        headerButtons.appendChild(createBtn("Register", () => navigateTo('/register')));
    }
}
function createBtn(t, fn) { const b = document.createElement('button'); b.className = 'liquid-btn'; b.textContent = t; b.onclick = fn; return b; }

// ---------- AUTH PAGES ----------
function renderRegister(){
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
    <h2 class="text-2xl font-bold">Register</h2>
    <form id="reg-form" class="flex flex-col gap-2">
      <label>First Name</label><input name="firstName" class="input-field" required>
      <label>Last Name</label><input name="lastName" class="input-field" required>
      <label>Birthday</label><input type="date" name="birthday" class="input-field" required>
      <label>School</label><input name="school" class="input-field" required>
      <label>Phone</label><input name="phone" class="input-field" required>
      <label>Exam Year</label><select name="examYear" class="input-field"><option>2026 A/L</option><option>2027 A/L</option><option>2028 A/L</option></select>
      <label>Email</label><input type="email" name="email" class="input-field" required>
      <label>Password</label><input type="password" name="password" class="input-field" required>
      <button type="submit" class="liquid-btn w-full">Register</button>
      <div id="reg-error" class="text-red-400 text-sm"></div>
    </form>
    <button class="google-btn w-full mt-3" id="google-register"><img src="https://img.freepik.com/premium-vector/google-logo-icon-transparent-background_1273375-1570.jpg?semt=ais_hybrid&w=740&q=80" class="google-logo">Continue with Google</button>
  </div>`;
  document.getElementById('reg-form').onsubmit = async e => {
    e.preventDefault();
    const f = e.target;
    try {
      const cred = await createUserWithEmailAndPassword(auth, f.email.value, f.password.value);
      await updateProfile(cred.user, { displayName: f.firstName.value + ' ' + f.lastName.value });
      await setDoc(doc(db, 'users', cred.user.uid), { firstName: f.firstName.value, lastName: f.lastName.value, birthday: f.birthday.value, school: f.school.value, phone: f.phone.value, examYear: f.examYear.value, email: f.email.value, createdAt: new Date().toISOString() });
      navigateTo('/home');
    } catch(err) { document.getElementById('reg-error').textContent = err.message; }
  };
  document.getElementById('google-register').onclick = () => googleLoginLogic();
}

function renderLogin(){
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
    <h2 class="text-2xl font-bold">Login</h2>
    <form id="login-form" class="flex flex-col gap-2">
      <input type="email" name="email" placeholder="Email" class="input-field" required>
      <input type="password" name="password" placeholder="Password" class="input-field" required>
      <button type="submit" class="liquid-btn w-full">Login</button>
      <div id="login-error" class="text-red-400 text-sm"></div>
    </form>
    <button id="google-login" class="google-btn w-full"><img src="https://img.freepik.com/premium-vector/google-logo-icon-transparent-background_1273375-1570.jpg?semt=ais_hybrid&w=740&q=80" class="google-logo">Continue with Google</button>
    <div id="complete-profile" style="display:none" class="mt-4 border-t pt-4"></div>
  </div>`;
  document.getElementById('login-form').onsubmit = async e => {
    e.preventDefault();
    try { await signInWithEmailAndPassword(auth, e.target.email.value, e.target.password.value); navigateTo('/home'); } 
    catch(err) { document.getElementById('login-error').textContent = err.message; }
  };
  document.getElementById('google-login').onclick = () => googleLoginLogic();
}

async function googleLoginLogic() {
  try {
    const res = await signInWithPopup(auth, googleProvider);
    const snap = await getDoc(doc(db, "users", res.user.uid));
    if (snap.exists()) navigateTo('/home');
    else {
      const cp = document.getElementById("complete-profile");
      document.getElementById("login-form").style.display = "none";
      document.getElementById("google-login").style.display = "none";
      cp.style.display = "block";
      const parts = res.user.displayName ? res.user.displayName.split(" ") : ["",""];
      cp.innerHTML = `<h3 class="font-bold mb-2 text-blue-400">Complete Profile</h3>
        <input id="p-fn" placeholder="First Name" class="input-field" value="${parts[0]}">
        <input id="p-ln" placeholder="Last Name" class="input-field" value="${parts[1]}">
        <input id="p-bd" type="date" class="input-field">
        <input id="p-sc" placeholder="School" class="input-field">
        <input id="p-ph" placeholder="Phone" class="input-field">
        <select id="p-ex" class="input-field"><option>2026 A/L</option><option>2027 A/L</option><option>2028 A/L</option></select>
        <button id="save-p-btn" class="liquid-btn w-full">Save & Continue</button>`;
      document.getElementById("save-p-btn").onclick = async () => {
        const data = { firstName: document.getElementById("p-fn").value, lastName: document.getElementById("p-ln").value, email: res.user.email, birthday: document.getElementById("p-bd").value, school: document.getElementById("p-sc").value, phone: document.getElementById("p-ph").value, examYear: document.getElementById("p-ex").value, createdAt: new Date().toISOString() };
        await setDoc(doc(db, "users", res.user.uid), data);
        await updateProfile(res.user, { displayName: data.firstName + " " + data.lastName });
        navigateTo('/home');
      };
    }
  } catch(err) { alert(err.message); }
}

// ---------- HOME & DASHBOARD ----------
async function renderHome() {
    appContainer.innerHTML = `
    <div class="space-y-6 max-w-2xl mx-auto">
        <div class="bg-slate-800 p-6 rounded-2xl text-center border border-slate-700">
            <h2 class="text-3xl font-bold mb-4">Welcome, ${currentUser.displayName}!</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button onclick="navigateTo('/recording')" class="liquid-btn py-4 text-xl">üé• Recordings</button>
                <button onclick="navigateTo('/timetable')" class="liquid-btn py-4 text-xl">üìÖ Timetable</button>
            </div>
        </div>
        <div class="bg-slate-800 p-6 rounded-2xl">
            <h3 class="text-xl font-bold mb-4">Study Log</h3>
            <form id="daily-form" class="flex gap-2">
                <input type="date" name="date" value="${new Date().toISOString().slice(0,10)}" class="input-field" required>
                <input type="number" name="hours" placeholder="Hours" class="input-field" required>
                <button class="liquid-btn">Add</button>
            </form>
            <div class="grid grid-cols-1 gap-6 mt-6">
                <canvas id="weekly-chart" class="bg-slate-900 rounded-xl p-4"></canvas>
                <canvas id="monthly-chart" class="bg-slate-900 rounded-xl p-4"></canvas>
            </div>
        </div>
    </div>`;
    
    document.getElementById('daily-form').onsubmit = async e => {
        e.preventDefault();
        await addDoc(collection(db, 'studyLogs'), { userId: currentUser.uid, date: e.target.date.value, hours: Number(e.target.hours.value) });
        renderHomeCharts();
    };
    renderHomeCharts();
}

async function renderHomeCharts() {
    const snap = await getDocs(query(collection(db, 'studyLogs'), where('userId', '==', currentUser.uid)));
    const logs = snap.docs.map(d => d.data());
    const today = new Date();
    
    const weeklyData = [];
    for(let i=6;i>=0;i--){
        const d = new Date(); d.setDate(today.getDate()-i);
        const ds = d.toISOString().slice(0,10);
        weeklyData.push(logs.filter(x => x.date === ds).reduce((a,b) => a+b.hours, 0));
    }

    new Chart(document.getElementById('weekly-chart'), {
        type: 'line',
        data: { labels: Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(today.getDate()-6+i); return d.toISOString().slice(5,10);}), datasets: [{ label: 'Hours', data: weeklyData, borderColor: '#8b5cf6', backgroundColor: 'rgba(139,92,246,0.2)', fill: true }] },
        options: { scales: { y: { beginAtZero: true, ticks: {color: '#fff'} }, x: { ticks: {color: '#fff'} } } }
    });

    const monthly = {};
    logs.forEach(x => { const m = x.date.slice(0,7); monthly[m] = (monthly[m] || 0) + x.hours; });
    const sortedM = Object.keys(monthly).sort();
    new Chart(document.getElementById('monthly-chart'), {
        type: 'line',
        data: { labels: sortedM, datasets: [{ label: 'Monthly Hours', data: sortedM.map(m=>monthly[m]), borderColor: '#22d3ee', backgroundColor: 'rgba(34,211,238,0.2)', fill: true }] },
        options: { scales: { y: { beginAtZero: true, ticks: {color: '#fff'} }, x: { ticks: {color: '#fff'} } } }
    });
}

// ---------- PROFILE ----------
async function renderProfile() {
    const snap = await getDoc(doc(db, 'users', currentUser.uid));
    const u = snap.data();
    appContainer.innerHTML = `<div class="bg-slate-800 p-6 rounded-xl max-w-md mx-auto space-y-4 border border-slate-700">
        <h2 class="text-2xl font-bold">Edit Profile</h2>
        <form id="profile-form" class="space-y-2">
            <label>First Name</label><input name="firstName" class="input-field" value="${u.firstName}">
            <label>Last Name</label><input name="lastName" class="input-field" value="${u.lastName}">
            <label>Birthday</label><input type="date" name="birthday" class="input-field" value="${u.birthday}">
            <label>School</label><input name="school" class="input-field" value="${u.school}">
            <label>Phone</label><input name="phone" class="input-field" value="${u.phone}">
            <button class="liquid-btn w-full mt-4">Update Profile</button>
            <div id="p-msg" class="text-green-400 text-center text-sm"></div>
        </form>
    </div>`;
    document.getElementById('profile-form').onsubmit = async e => {
        e.preventDefault();
        const f = e.target;
        await updateDoc(doc(db, 'users', currentUser.uid), { firstName: f.firstName.value, lastName: f.lastName.value, birthday: f.birthday.value, school: f.school.value, phone: f.phone.value });
        document.getElementById('p-msg').textContent = "Saved Successfully!";
    };
}

// ---------- TIMETABLE ----------
async function renderTimetable() {
  const ttRef = doc(db, "timetable", currentUser.uid);
  const ttSnap = await getDoc(ttRef);
  const savedData = ttSnap.exists() ? ttSnap.data() : {};
  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  const hours = Array.from({length:24}, (_,i)=>{ const f = (h)=> (h%12||12)+(h<12?"am":"pm"); return `${f(i)} - ${f(i+1)}`; });

  appContainer.innerHTML = `
    <div class="bg-slate-800 p-6 rounded-xl w-full">
      <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
        <h2 class="text-2xl font-bold">Weekly Timetable</h2>
        <div class="flex gap-2">
          <button id="tt-fill" class="liquid-btn text-xs">Fill Free</button>
          <button id="tt-clear" class="liquid-btn text-xs">Clear</button>
          <button id="tt-save" class="liquid-btn text-xs">Save</button>
          <button id="tt-pdf" class="liquid-btn text-xs">PDF</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full border-collapse border border-slate-700 text-xs">
          <thead><tr><th class="border border-slate-700 p-2">Hour</th>${days.map(d=>`<th class="border border-slate-700 p-2">${d}</th>`).join("")}</tr></thead>
          <tbody>${hours.map((h, hi)=> `<tr><td class="border border-slate-700 p-2 font-bold">${h}</td>${days.map((_, di)=> `<td class="border border-slate-700 p-1"><input id="tt_${di}_${hi}" class="bg-slate-900 w-24 p-1 rounded text-center" value="${savedData[`tt_${di}_${hi}`]||''}"></td>`).join("")}</tr>`).join("")}</tbody>
        </table>
      </div>
      <div id="tt-msg" class="mt-2 text-blue-400"></div>
    </div>`;

  document.getElementById("tt-fill").onclick = () => { days.forEach((_,d)=> hours.forEach((_,h)=> { const el = document.getElementById(`tt_${d}_${h}`); if(el && !el.value) el.value="Free"; })); };
  document.getElementById("tt-clear").onclick = () => { if(confirm("Clear all?")) days.forEach((_,d)=> hours.forEach((_,h)=> document.getElementById(`tt_${d}_${h}`).value="")); };
  document.getElementById("tt-save").onclick = async () => {
    const data = {}; days.forEach((_,d)=> hours.forEach((_,h)=> { const val = document.getElementById(`tt_${d}_${h}`).value; if(val) data[`tt_${d}_${h}`] = val; }));
    await setDoc(ttRef, data); document.getElementById("tt-msg").textContent = "Timetable Saved!";
  };
  document.getElementById("tt-pdf").onclick = () => {
    const pdf = new jspdf.jsPDF('l', 'pt', 'a4');
    const tableData = hours.map((h, hi) => [h, ...days.map((_, di) => document.getElementById(`tt_${di}_${hi}`).value)]);
    pdf.autoTable({ head: [['Hour', ...days]], body: tableData, styles: { fontSize: 7 } });
    pdf.save("timetable.pdf");
  };
}

// ---------- ADMIN PANEL ----------
async function renderAdmin() {
    if (currentUser.uid !== ADMIN_UID) return navigateTo('/home');
    appContainer.innerHTML = `<div class="space-y-6">
        <h2 class="text-3xl font-bold">Admin Panel</h2>
        <div class="bg-slate-800 p-6 rounded-xl space-y-4">
            <h3 class="text-xl font-bold">Add Recording</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                <input id="rec-title" placeholder="Title" class="input-field">
                <input id="rec-link" placeholder="Link" class="input-field">
                <select id="rec-subject" class="input-field"><option value="combine">Combine Maths</option><option value="physics">Physics</option><option value="chemistry">Chemistry</option></select>
                <select id="rec-type" class="input-field"><option value="theory">Theory</option><option value="revision">Revision</option><option value="paper">Paper</option></select>
            </div>
            <button onclick="addRecAdmin()" class="liquid-btn w-full">Add Recording</button>
        </div>
        <div class="bg-slate-800 p-6 rounded-xl">
            <h3 class="text-xl font-bold mb-4">Users</h3>
            <input id="admin-search" placeholder="Search..." class="input-field mb-4">
            <div id="admin-users-list" class="space-y-2"></div>
        </div>
        <div id="admin-user-details"></div>
    </div>`;

    const usersSnap = await getDocs(collection(db, 'users'));
    const users = usersSnap.docs.map(d => ({id: d.id, ...d.data()}));
    const list = document.getElementById('admin-users-list');
    
    const renderList = (arr) => {
        list.innerHTML = "";
        arr.forEach(u => {
            const d = document.createElement('div');
            d.className = "bg-slate-900 p-3 rounded flex justify-between items-center";
            d.innerHTML = `<span>${u.firstName} ${u.lastName} (${u.school})</span><div class="flex gap-2"><button class="liquid-btn text-xs" onclick="viewAdminUser('${u.id}')">View</button><button class="liquid-btn text-xs bg-red-600" onclick="deleteUserAdmin('${u.id}')">Del</button></div>`;
            list.appendChild(d);
        });
    };
    renderList(users);
    document.getElementById('admin-search').oninput = e => renderList(users.filter(u => (u.firstName+u.lastName+u.school).toLowerCase().includes(e.target.value.toLowerCase())));
}

window.addRecAdmin = async () => {
    const title = document.getElementById('rec-title').value;
    const link = document.getElementById('rec-link').value;
    const subject = document.getElementById('rec-subject').value;
    const type = document.getElementById('rec-type').value;
    if(!title || !link) return alert("Fill all fields");
    await addDoc(collection(db, "recordings"), { title, link, subject, type, createdAt: new Date().toISOString() });
    alert("Added!");
};

window.viewAdminUser = async (uid) => {
    const u = (await getDoc(doc(db, 'users', uid))).data();
    const logs = (await getDocs(query(collection(db, 'studyLogs'), where('userId', '==', uid)))).docs.map(d=>d.data());
    const det = document.getElementById('admin-user-details');
    det.className = "bg-slate-800 p-6 rounded-xl mt-6 animate-fade-in";
    det.innerHTML = `<h3 class="text-xl font-bold">${u.firstName} ${u.lastName}</h3><p>School: ${u.school} | Phone: ${u.phone}</p><canvas id="admin-user-chart" class="mt-4 bg-slate-900 p-4 rounded"></canvas>`;
    
    const sorted = logs.sort((a,b)=> new Date(a.date)-new Date(b.date)).slice(-7);
    new Chart(document.getElementById('admin-user-chart'), { type: 'line', data: { labels: sorted.map(l=>l.date), datasets: [{label:'Hours', data: sorted.map(l=>l.hours), borderColor: '#0ea5e9'}] } });
};

window.deleteUserAdmin = async (uid) => { if(confirm("Delete user?")) { await deleteDoc(doc(db, 'users', uid)); renderAdmin(); } };

// ---------- RECORDINGS SYSTEM ----------
function renderSubjects() {
    appContainer.innerHTML = `<h2 class="text-3xl font-bold mb-6 text-center">Recordings</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        ${['combine', 'physics', 'chemistry'].map(s => `<button onclick="navigateTo('/recording/${s}')" class="liquid-btn py-10 text-2xl uppercase border border-slate-600">${s} Maths</button>`).join("")}
    </div>`;
}

function renderType(s) {
    appContainer.innerHTML = `<h2 class="text-3xl font-bold mb-6 text-center capitalize">${s}</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        ${['theory', 'revision', 'paper'].map(t => `<button onclick="navigateTo('/recording/${s}/${t}')" class="liquid-btn py-10 text-2xl uppercase border border-slate-600">${t}</button>`).join("")}
    </div>`;
}

async function renderLessons(s, t) {
    appContainer.innerHTML = `<h2 class="text-2xl font-bold mb-4 capitalize">${s} - ${t}</h2><div id="lesson-list" class="grid gap-3"></div>`;
    const q = query(collection(db, "recordings"), where("subject", "==", s), where("type", "==", t));
    const snap = await getDocs(q);
    const list = document.getElementById('lesson-list');
    snap.forEach(d => {
        const rec = d.data();
        const div = document.createElement('div');
        div.className = "bg-slate-800 p-4 rounded-xl flex justify-between items-center border border-slate-700";
        div.innerHTML = `<span>${rec.title}</span><div class="flex gap-2"><a href="${rec.link}" target="_blank" class="liquid-btn text-xs">Watch</a><button class="liquid-btn text-xs bg-slate-600" onclick="openLessonPageAdmin('${d.id}', '${rec.title}')">Contents</button></div>`;
        list.appendChild(div);
    });
}

window.openLessonPageAdmin = (id, title) => {
    appContainer.innerHTML = `<div class="bg-slate-800 p-6 rounded-xl space-y-4">
        <h2 class="text-2xl font-bold">${title} - Extra Contents</h2>
        ${currentUser.uid === ADMIN_UID ? `<div class="flex gap-2"><input id="c-text" placeholder="Title" class="input-field"><input id="c-link" placeholder="Link" class="input-field"><button onclick="addContent('${id}')" class="liquid-btn">Add</button></div>` : ""}
        <div id="content-list" class="space-y-2"></div>
    </div>`;
    loadLessonContents(id);
};

async function loadLessonContents(id) {
    const list = document.getElementById('content-list'); list.innerHTML = "";
    const snap = await getDocs(query(collection(db, "lessonContents"), where("lessonId", "==", id), orderBy("order", "asc")));
    snap.forEach(d => {
        const c = d.data();
        const div = document.createElement('div'); div.className = "bg-slate-900 p-3 rounded flex justify-between";
        div.innerHTML = `<a href="${c.link}" target="_blank" class="text-blue-400">${c.text}</a>
            ${currentUser.uid === ADMIN_UID ? `<div><button onclick="moveContent('${d.id}', -1, '${id}')">‚¨ÜÔ∏è</button><button onclick="moveContent('${d.id}', 1, '${id}')">‚¨áÔ∏è</button><button onclick="deleteContent('${d.id}', '${id}')">üóëÔ∏è</button></div>` : ""}`;
        list.appendChild(div);
    });
}

window.addContent = async (lid) => {
    const t = document.getElementById('c-text').value; const l = document.getElementById('c-link').value;
    const snap = await getDocs(query(collection(db, "lessonContents"), where("lessonId", "==", lid)));
    await addDoc(collection(db, "lessonContents"), { lessonId: lid, text: t, link: l, order: snap.size + 1 });
    loadLessonContents(lid);
};

window.deleteContent = async (id, lid) => { await deleteDoc(doc(db, "lessonContents", id)); loadLessonContents(lid); };
window.moveContent = async (id, dir, lid) => {
    const ref = doc(db, "lessonContents", id); const snap = await getDoc(ref); const d = snap.data();
    const newOrder = d.order + dir; if(newOrder < 1) return;
    const q = query(collection(db, "lessonContents"), where("lessonId", "==", lid), where("order", "==", newOrder));
    const swap = await getDocs(q); if(swap.empty) return;
    await updateDoc(ref, {order: newOrder}); await updateDoc(doc(db, "lessonContents", swap.docs[0].id), {order: d.order});
    loadLessonContents(lid);
};

function renderWelcome(){
  appContainer.innerHTML = `<div class="flex flex-col items-center justify-center h-96 gap-6 text-center">
    <h2 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Study Progress Tracker</h2>
    <p class="text-slate-400 max-w-sm">Manage your study hours, recordings and timetable in one place.</p>
    <div class="flex gap-4"><button onclick="navigateTo('/login')" class="liquid-btn px-10">Login</button><button onclick="navigateTo('/register')" class="liquid-btn px-10 bg-slate-700">Register</button></div>
  </div>`;
}

window.navigateTo = navigateTo;
</script>

</head>
<body class="p-4">
<header class="w-full p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center mb-6 sticky top-0 z-50 rounded-xl">
  <h1 class="text-2xl font-bold cursor-pointer flex items-center" onclick="navigateTo('/home')">
    <span class="text-blue-500">Study</span>Tracker
  </h1>
  <div id="header-buttons" class="flex gap-2"></div>
</header>
<main id="app-container" class="max-w-5xl mx-auto"></main>
<footer class="mt-20 text-center text-slate-600 text-sm pb-10">
  &copy; 2024 StudyTracker. All rights reserved.
</footer>
</body>
</html>
